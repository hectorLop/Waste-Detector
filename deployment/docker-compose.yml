version: '3'
services:
  frontend:
      build:
          context: .
          dockerfile: frontend.Dockerfile
      image: waste_detector_frontend
      container_name: waste_detector_frontend
      ports:
          - "8501:8501"
      labels:
          - "traefik.enable=true"
      command: python3 -m deployment.frontend
  backend:
      build:
          context: .
          dockerfile: backend.Dockerfile
      image: waste_detector_backend
      container_name: waste_detector_backend
      ports:
          - "5000:5000"
      command: python3 -m uvicorn deployment.backend:app --host 0.0.0.0 --port 5000
  traefik: # new
    image: traefik:v2.2
    ports:
      - 8008:80
      - 8081:8080
    volumes:
      - "./traefik.dev.toml:/etc/traefik/traefik.toml"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
